@model HitechCraft.WebApplication.Models.PlayerSkinViewModel
@{
    ViewBag.Title = "UploadSkin";
}

<h2>UploadSkin</h2>

<div class="progress progress-striped active" style="visibility: hidden">
    <div class="progress-bar" style="width: 0;"></div>
</div>

<fieldset>
    <legend>Добавить изображение</legend>

    <div class="editor-label">Файл изображения</div>
    <div class="editor-field">
        <input type="file" accept="image/png" name="uploadSkinImage" id="file-upload" />
    </div>
</fieldset>

<div id="skin-container">
    <img src="data:image;base64,@System.Convert.ToBase64String(Model.Image)" id="skin-image" class="frontSkin" hidden=""/>
    <img src="data:image;base64,@System.Convert.ToBase64String(Model.Image)" id="skin-image" class="backSkin" hidden=""/>
</div>

<script type="text/javascript">

    $(document).ready(function () {

        renderMCSkins('frontSkin', 10);
        renderMCSkins('backSkin', 10);

        $('#file-upload').fileupload({
            url: '@Url.Action("UploadSkinImage")',
            type: 'POST',
            autoUpload: true
        }).on('fileuploaddone', function (e, data) {
            if (!data.result.status) {
                console.log(data.result);
                $.each(data.result.data, function (i, object) {
                    $.each(object.Errors, function (j, error) {
                        growlError(error.ErrorMessage);
                    });
                });
            }
            else {
                location.reload();
            }
        }).on('fileuploadprogressall', function (e, data) {

            var progress = parseInt(data.loaded / data.total * 100, 10);

            $('.progress .progress-bar').css('visibility', 'visible');
            $('.progress .progress-bar').css('width', progress + '%');
            $('.progress .progress-bar').html(progress + '%');
            $('#skin-image').attr("src", "");

            if (progress >= 100) {
                $('#skin-image').attr("src", "");
                setTimeout(function () {
                    location.reload();
                }, 4000);
            }
        });
    });
</script>